db.transactions.aggregate(
	{$match: {
		"participants.address":"1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa",
		time:{$lte: 1317034821}
	}},
	{$project: {
		_id:0, "participants":1,
	}},
	{$unwind: "$participants"
	},
	{$group: {
		_id: "$participants.address",
		balance: {$sum: "$participants.value"},
	}},
	{$match: {
		"_id":"1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa"
	}},
	{$project: {
		_id:0, "balance":1,
	}}
)

 		
 		
 		
 		
 		
 		
 		
 		
 		
 		
 		
 		
 		
 		
 		